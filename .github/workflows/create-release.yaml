name: Create Enterprise Release
on:
  workflow_call:
    inputs:
      environment:
        required: true
        type: string
        description: "Environment deployed to (e.g., production)"

jobs:
  release:
    runs-on: ubuntu-latest
    permissions:
      contents: write # âš ï¸ REQUIRED: To create tags and releases
      pull-requests: read # Required to read PR titles for changelogs
    steps:
      - name: Checkout Code
        uses: actions/checkout@v6
        with:
          fetch-depth: 0 # âš ï¸ Critical: Must fetch full history to generate notes

      - name: Generate Tag Name
        id: tag
        run: |
          # Strategy: Use Run Number for uniqueness (e.g., v105)
          # You can change this to Date or Semantic Versioning later
          TAG_NAME="v${{ github.run_number }}"
          echo "tag_name=$TAG_NAME" >> $GITHUB_OUTPUT

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ steps.tag.outputs.tag_name }}
          name: "Production Release ${{ steps.tag.outputs.tag_name }}"
          generate_release_notes: true # ðŸ‘ˆ This looks for .github/release.yml in the Spoke
          draft: false
          prerelease: false